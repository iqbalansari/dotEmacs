* Load scala-mode2
** Load scala-mode if not already loaded
   #+begin_src emacs-lisp
     (unless (fboundp #'scala-mode)
       (load "scala-mode2"))
   #+end_src

** Enable scala-mode2
   #+begin_src emacs-lisp
     (scala-mode)
   #+end_src

** Use eager mode for indenting code
   #+begin_src emacs-lisp
     (setq scala-indent:default-run-on-strategy scala-indent:eager-strategy)
   #+end_src


* Load sbt-mode
** Load it just once per session
  #+begin_src emacs-lisp
    (unless (fboundp 'start-sbt)
      (load "sbt-mode"))
  #+end_src


* Start ensime if inside 'ensime' project
** Always ask to connect ensime, if not already connected
   #+begin_src emacs-lisp
     (setq ensime-auto-connect 'ask)
   #+end_src

** Load ensime if not loaded already
  #+begin_src emacs-lisp
    (defun my-load-ensime ()
      (when (and (executable-find "sbt")
                 (version< (nth 3 (split-string (shell-command-to-string "sbt --version")))
                           "0.13"))
        (warn "Ensime requires sbt 0.13.x and upwards for sbt project"))
      (load "ensime"))

    (unless (fboundp #'ensime-mode)
      (my-load-ensime))
  #+end_src

** Enable ensime
   #+begin_src emacs-lisp
     (ignore-errors (if (and buffer-file-name
                             (equal (file-name-extension buffer-file-name) "scala")
                             (locate-dominating-file buffer-file-name ".ensime"))
                        (ensime-mode +1)
                      (unless (locate-dominating-file buffer-file-name ".ensime")
                        (warn "Not in ensime project, do M-x ensime-config-gen"))))
   #+end_src



* Enable flycheck
  #+begin_src emacs-lisp
    (unless (or (not (buffer-file-name))
                (string-equal (file-name-extension buffer-file-name) "sbt"))
      (flycheck-mode))
  #+end_src


* Flash current line after jumping to definition
  #+begin_src emacs-lisp
    (my-highlight-line-after-func geiser-edit-symbol-at-point)
  #+end_src


* Use .ensime files to identify project roots in projectile
  #+begin_src emacs-lisp
    (eval-after-load 'projectile
      '(add-to-list 'projectile-project-root-files ".ensime"))
  #+end_src
