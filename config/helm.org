* Install helm packages
  #+begin_src emacs-lisp
    (iqbal-install-packages '(helm helm-descbinds helm-projectile helm-c-yasnippet helm-company wgrep-helm))

    (when (executable-find "ag")
      (iqbal-install-package 'helm-ag))
  #+end_src


* Enable fuzzy-match everywhere
  #+begin_src emacs-lisp
    (setq helm-mode-fuzzy-match t)
    (setq helm-recentf-fuzzy-match t)
    (setq helm-buffers-fuzzy-matching t)
    (setq helm-locate-fuzzy-match t)
    (setq helm-M-x-fuzzy-match t)
    (setq helm-semantic-fuzzy-match t)
    (setq helm-imenu-fuzzy-match t)
    (setq helm-apropos-fuzzy-match t)
    (setq helm-lisp-fuzzy-completion t)
    (setq helm-completion-in-region-fuzzy-match t)
  #+end_src


* Enable helm
  #+begin_src emacs-lisp
    (helm-mode +1)
  #+end_src


* Turn on helm-projectile
  #+begin_src emacs-lisp
    (with-eval-after-load 'projectile
      (helm-projectile-on))

    (setq projectile-switch-project-action #'helm-projectile)
  #+end_src


* Instruct projectile to use helm for completing read
  #+begin_src emacs-lisp
    (with-eval-after-load 'projectile
      (setq projectile-completion-system 'helm))
  #+end_src


* Add projectile sources to helm-mini
  #+begin_src emacs-lisp
    (with-eval-after-load 'helm-projectile
      (setq helm-mini-default-sources '(helm-source-buffers-list
                                        helm-source-projectile-buffers-list
                                        helm-source-projectile-files-list 
                                        helm-source-buffer-not-found
                                        helm-source-recentf)))
  #+end_src


* helm-descbinds configuration
  #+begin_src emacs-lisp
    (setq helm-descbinds-window-style 'split-window)
    (helm-descbinds-mode +1)
  #+end_src


* Echo input in header line
  Taken from http://www.reddit.com/r/emacs/comments/3asbyn/new_and_very_useful_helm_feature_enter_search/
  #+begin_src emacs-lisp
    (when (display-graphic-p)
      (setq helm-echo-input-in-header-line t
            helm-split-window-in-side-p t)
      (add-hook 'helm-minibuffer-set-up-hook 'helm-hide-minibuffer-maybe))
  #+end_src


* Do not prompt when creating new file
  #+begin_src emacs-lisp
    (setq helm-ff-newfile-prompt-p nil)
  #+end_src


* Helm company configuration
  #+begin_src emacs-lisp
    (with-eval-after-load 'company
      (define-key company-active-map (kbd "C-<return>") 'helm-company))
  #+end_src


* Various mode settings
  #+begin_src emacs-lisp
    (setq haskell-completing-read-function #'helm--completing-read-default)
  #+end_src


* Helm kill-ring configuration
  #+begin_src emacs-lisp
    (global-set-key (kbd "M-y") #'helm-show-kill-ring)
  #+end_src


* Sources for helm-files
  Remove source for buffers and move source for current directory to the top
  #+begin_src emacs-lisp
    (setq helm-for-files-preferred-list '(helm-source-files-in-current-dir
                                          helm-source-find-files
                                          helm-source-recentf
                                          helm-source-bookmarks
                                          helm-source-locate))

    (with-eval-after-load 'helm-projectile
      (setq helm-for-files-preferred-list '(helm-source-files-in-current-dir
                                            helm-source-projectile-files-list 
                                            helm-source-find-files
                                            helm-source-recentf
                                            helm-source-bookmarks
                                            helm-source-locate)))
  #+end_src


* Helm Imenu configuration
** Keybinding to quickly jump to a symbol in buffer
   #+begin_src emacs-lisp
     (global-set-key (kbd "C-c s") 'helm-imenu)
   #+end_src

** Do not directly jump to the definition even if there is just on candidate
   #+begin_src emacs-lisp
     (setq helm-imenu-execute-action-at-once-if-one nil)
   #+end_src


* Do not complete in step while org-refiling
  Otherwise only the top level completions are shown by helm
  #+begin_src emacs-lisp
    (setq org-outline-path-complete-in-steps nil)
  #+end_src


* Keybindings
** Global keybindings
  #+begin_src emacs-lisp
    (global-set-key (kbd "C-x C-f") #'helm-find-files)
    (global-set-key (kbd "M-x") #'helm-M-x)
    (global-set-key (kbd "C-x b") #'helm-mini)
    (global-set-key [remap locate] #'helm-locate)
  #+end_src


** Swap C-z and tab
   #+begin_src emacs-lisp
     (with-eval-after-load 'helm
       (define-key helm-map (kbd "<tab>") 'helm-execute-persistent-action)
       (define-key helm-map (kbd "C-i") 'helm-execute-persistent-action)
       (define-key helm-map (kbd "C-z")  'helm-select-action))
   #+end_src
