* Create scratch buffer for a given major mode
  #+BEGIN_SRC emacs-lisp
    (defun iqbal-get-active-major-mode ()
      (if (eq major-mode 'org-mode)
          (let ((element (org-element-at-point)))
            ;; If inside an org-src block return the language of the block
            (if (eq (org-element-type element) 'src-block)
                (org-src--get-lang-mode (org-element-property :language element))
              major-mode))
        ;; Otherwise return current major-mode
        major-mode))

    (defun iqbal-create-scratch-buffer (&optional read-major-mode-p)
      (interactive "P")
      (let* ((major-mode-function (if read-major-mode-p
                                      (intern (completing-read "Major mode: " (iqbal-get-all-major-modes-names)))
                                    (iqbal-get-active-major-mode)))
             (scratch-buffer-name (concat "*scratch ["
                                          (replace-regexp-in-string "-mode$" ""
                                                                    (symbol-name major-mode-function))
                                          "]*")))
        (switch-to-buffer (if (get-buffer scratch-buffer-name)
                              scratch-buffer-name
                            (with-current-buffer (generate-new-buffer scratch-buffer-name)
                              (funcall major-mode-function)
                              (when comment-start
                                (insert "Here is buffer for you to scratch :)\n")
                                (comment-region (point-min) (point-max)))
                              (goto-char (point-max))
                              (current-buffer))))))


    (defun iqbal-get-all-major-modes-names ()
      (remove-duplicates (mapcar #'symbol-name
                                 (cl-remove-if-not #'symbolp
                                                (mapcar #'cdr auto-mode-alist)))
                         :test #'string=))
  #+END_SRC


* Keybinding to create scratch buffer
  #+BEGIN_SRC emacs-lisp
    (global-set-key (kbd "C-c j") #'iqbal-create-scratch-buffer)
  #+END_SRC
